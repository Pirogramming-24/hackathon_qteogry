{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&A Service</title>
    
    <link rel="stylesheet" href="{% static 'questions/css/main_ny.css' %}">
</head>
<body>

    <div class="header-container_ny">
        <h1 class="page-title_ny">[1ì¼ì°¨] Django ì‹¤ìŠµ</h1>
        
        <nav class="tab-menu_ny">
            <a href="?sort=all" class="tab-item_ny {% if sort_mode == 'all' %}active_ny{% endif %}">ëª¨ë“  ì§ˆë¬¸</a>
            <a href="?sort=concept" class="tab-item_ny {% if sort_mode == 'concept' %}active_ny{% endif %}">ê°œë… ì§ˆë¬¸ë§Œ</a>
            <a href="?sort=likes" class="tab-item_ny {% if sort_mode == 'likes' %}active_ny{% endif %}">ê³µê° ìˆœìœ¼ë¡œ</a>
            <a href="?sort=my" class="tab-item_ny {% if sort_mode == 'my' %}active_ny{% endif %}">ë‚´ ì§ˆë¬¸</a>
        </nav>
    </div>

    <main class="main-container_ny">
        
        <section class="question-list_ny">
            {% for question in questions %}
            <a href="{% url 'questions:question_detail' session.id question.id %}?sort={{ sort_mode }}" style="text-decoration: none; color: inherit;">
                <div id="card-{{ question.id }}" class="question-card_ny status-{{ question.status }}">
                    <div class="card-header_ny">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="width: 30px; height: 30px; background: #ddd; border-radius: 50%;"></div>
                            <span style="font-weight: bold;">{{ question.user.username }}</span>
                        </div>
                        <span class="badge_ny 
                            {% if question.category == 'CONCEPT' %}badge-concept_ny
                            {% elif question.category == 'ERROR' %}badge-error_ny
                            {% else %}badge-etc_ny{% endif %}">
                            {{ question.get_category_display }}
                        </span>
                    </div>

                    <a href="{% url 'questions:question_detail' session.id question.id %}" style="text-decoration: none; color: inherit;">
                        <div class="card-content_ny">
                            {{ question.title }}
                        </div>
                    </a>

                    <div class="card-footer_ny">
                        <span>{{ question.created_at|date:"Y.m.d H:i" }}</span>
                        <span class="like-btn_ny" data-question-id="{{ question.id }}" style="cursor: pointer; z-index: 10;">
                            ì €ë„ ê¶ê¸ˆí•´ìš” ğŸ˜¢ 
                            <span id="like-count-list-{{ question.id }}">{{ question.likes.count }}</span>
                        </span>
                    </div>
                </div>
            </a>

            {% empty %}
                <p style="text-align: center; color: #888; margin-top: 50px;">
                    ì•„ì§ ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.
                </p>
            {% endfor %}

            <a href="{% url 'questions:question_main' session.id %}" class="floating-btn_ny" title="ì§ˆë¬¸ ì‘ì„±í•˜ê¸°">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 17.25V21H6.75L17.81 9.94L14.06 6.19L3 17.25ZM20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C17.98 2.9 17.35 2.9 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04Z" fill="black"/>
                </svg>
            </a>
        </section>

        <section class="write-section_ny">

            {% if selected_question %}
            
                <div class="question-detail-container-hs">
                    <div class="question-meta-hs">
                        <span class="question-user-hs">ğŸ‘¤ {{ selected_question.user }}</span>
                        <span class="badge_ny" style="margin-left: 10px;">{{ selected_question.get_category_display }}</span>
                    </div>

                    <h2 class="question-title-hs" style="color: #65E01D; margin-top: 10px;">
                        {{ selected_question.title }}
                    </h2>

                    <div class="question-info-hs" style="color: #888; font-size: 14px; margin-bottom: 20px;">
                        <span>{{ selected_question.created_at|date:"Y.m.d H:i" }}</span>
                        <span style="float: right;">
                            <div class="question-status-wrapper">
                                <select class="status-select_ny" data-question-id="{{ selected_question.id }}">
                                    <option value="OPEN" {% if selected_question.status == 'OPEN' %}selected{% endif %}>
                                        ğŸŸ¡ ëŒ€ê¸°
                                    </option>
                                    <option value="ANSWERED" {% if selected_question.status == 'ANSWERED' %}selected{% endif %}>
                                        âœ… ë‹µë³€ì™„ë£Œ
                                    </option>
                                </select>
                            </div>
                        </span>
                    </div>

                    <hr style="border: 0.5px solid #333; margin-bottom: 20px;">

                    {% if selected_question.image %}
                        <div class="question-image-hs" style="margin-bottom: 20px;">
                            <img src="{{ selected_question.image.url }}" alt="ì§ˆë¬¸ ì´ë¯¸ì§€" style="max-width: 100%; border-radius: 8px;">
                        </div>
                    {% endif %}

                    <div class="question-content-hs" style="font-size: 16px; line-height: 1.6; margin-bottom: 30px;">
                        {{ selected_question.content|linebreaks }}
                    </div>

                    <div class="question-like-hs" style="text-align: center; margin-bottom: 30px;">
                        <button class="like-btn_ny" data-question-id="{{ selected_question.id }}" 
                                style="background: #333; color: white; border: 1px solid transparent; padding: 10px 20px; border-radius: 20px; cursor: pointer; transition: 0.3s;">
                            ğŸ˜¢ ì €ë„ ê¶ê¸ˆí•´ìš” 
                            <span id="like-count-detail-{{ selected_question.id }}">{{ like_count }}</span>ê°œ
                        </button>
                    </div>

                    <hr style="border: 0.5px solid #333;">

                    <div class="comment-section-hs">
                        <h4 style="color: #65E01D;">ğŸ’¬ ëŒ“ê¸€</h4>

                        {% if comments %}
                        <ul class="comment-list-hs" style="list-style: none; padding-left: 0;">
                            {% for comment in comments %}
                            <li class="comment-item-hs" style="background: #2C2C2C; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                <div class="comment-meta-hs" style="display: flex; justify-content: space-between; margin-bottom: 5px; color: #aaa; font-size: 13px;">
                                    <span class="comment-user-hs">{{ comment.user }}</span>
                                    <span class="comment-created-at-hs">{{ comment.created_at|date:"Y.m.d H:i" }}</span>
                                </div>
                                <div class="comment-content-hs">
                                    {{ comment.content|linebreaks }}
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="no-comment-hs" style="color: #888; text-align: center; padding: 20px;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        {% endif %}
                    </div>
                </div>

            {% else %}
            
                <div class="form-title_ny">ì§ˆë¬¸ ì‘ì„±í•˜ê¸°</div>
                
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group_ny">
                        <label>ì§ˆë¬¸ ì¢…ë¥˜</label>
                        {{ form.category }}
                    </div>
                    <div class="form-group_ny">
                        <label>ì œëª©</label>
                        {{ form.title }}
                    </div>
                    <div class="form-group_ny">
                        <label>ë‚´ìš©</label>
                        {{ form.content }}
                    </div>
                    <div class="form-group_ny">
                        <label>ì´ë¯¸ì§€ ì²¨ë¶€</label>
                        {{ form.image }}
                    </div>
                    
                    <button type="submit" class="submit-btn_ny">ì§ˆë¬¸ ë“±ë¡í•˜ê¸°</button>
                </form>

            {% endif %}
        </section>
    </main>

    <script src="{% static 'questions/js/main_ny.js' %}"></script>
</body>
</html>